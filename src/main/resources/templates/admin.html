<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Админ панель</title>
    <div th:replace="~{fragments/head :: head}"></div>

</head>
<body>
    <div th:replace="~{fragments/navbar :: navbar}"></div>
    
    <div class="container">
        <h1>Админ панель</h1>
        
        <!-- Статистика -->
        <div class="grid">
            <article class="primary-stat" style="text-align: center;">
                <h5>Всего пользователей</h5>
                <h2 th:text="${dashboardStats.totalUsers}"></h2>
            </article>
            <article class="success-stat" style="text-align: center;">
                <h5>Активные события</h5>
                <h2 th:text="${dashboardStats.activeEvents}"></h2>
            </article>
            <article class="info-stat" style="text-align: center;">
                <h5>Прогнозов сегодня</h5>
                <h2 th:text="${dashboardStats.predictionsMadeToday}"></h2>
            </article>
        </div>
        
        <!-- Таблица пользователей -->
        <div class="data-card">
            <div class="card-header">
                <h3>Все пользователи</h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table role="grid" class="centered-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Имя пользователя</th>
                                <th>Email</th>
                                <th>Роль</th>
                                <th>Успешные прогнозы</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="user : ${users}">
                                <td th:text="${user.id}"></td>
                                <td th:text="${user.username}"></td>
                                <td th:text="${user.email}"></td>
                                <td th:text="${user.role}"></td>
                                <td th:text="${user.successfulPredictions}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        
        <!-- События, ожидающие завершения -->
        <div class="data-card">
            <div class="card-header">
                <h3>События, ожидающие завершения</h3>
                <p class="text-muted">События, у которых истекло время завершения, но статус все еще ACTIVE</p>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table role="grid">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Название</th>
                                <th>Статус</th>
                                <th>Время завершения</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${#lists.isEmpty(pendingEvents)}">
                                <td colspan="4" class="text-center">Нет событий, ожидающих завершения</td>
                            </tr>
                            <tr th:each="event : ${pendingEvents}">
                                <td
                                    th:text="${event.id}">
                                </td>
                                <td> <a th:href="@{/events/details/{id}(id=${event.id})}" th:text="${event.title}"></a></td>
                                <td th:text="${event.status}"></td>
                                <td th:text="${#temporals.format(event.closesAt, 'dd.MM.yyyy HH:mm:ss')}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    
    <div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>