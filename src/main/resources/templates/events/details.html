<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head}"></head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>
<main class="container">
    <article>
        <h1 th:text="${event.title}"></h1>
        <p th:text="${event.description}"></p>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span th:text="${event.status}"></span></p>

        <div th:if="${successMessage}" style="background-color: #d4edda; color: #155724; padding: 10px; margin-bottom: 10px; border-radius: 4px;">
            <span th:text="${successMessage}"></span>
        </div>
        <div th:if="${errorMessage}" style="background-color: #f8d7da; color: #721c24; padding: 10px; margin-bottom: 10px; border-radius: 4px;">
            <span th:text="${errorMessage}"></span>
        </div>

        <div th:if="${!hasVoted}">
        <form method="post" th:action="@{/predictions/make}">
            
            <input type="hidden" name="eventId" th:value="${event.id}">
            
            <h3>–°–¥–µ–ª–∞–π—Ç–µ –≤–∞—à –≤—ã–±–æ—Ä:</h3>

            <div th:each="opt : ${event.optionsWithStats}" style="margin-bottom: 5px;">
                <label>
                    <input type="radio" name="chosenOptionId" th:value="${opt.optionId}" required>
                    <span th:text="${opt.text}">–¢–µ–∫—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞</span>
                </label>
            </div>
            <button type="submit" style="margin-top: 15px;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä</button>
        </form>
        </div>
        <hr>
        <div th:if="${hasVoted}" style="padding: 20px; background-color: #f0f0f0; border-radius: 8px; text-align: center;">
            <h3>‚úÖ –í—ã —É–∂–µ —Å–¥–µ–ª–∞–ª–∏ —Å—Ç–∞–≤–∫—É –≤ —ç—Ç–æ–º —Å–æ–±—ã—Ç–∏–∏</h3>
            <p>–î–æ–∂–¥–∏—Ç–µ—Å—å –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</p>
        </div>
        <form th:action="@{/events/delete/{id} (id=${event.id})}" th:method="GET"
              onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ?')">
            <button type="submit" class="secondary outline">–£–¥–∞–ª–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
        </form>

        <div style="margin-top: 10px;">
            <a href="/events/all" role="button" class="secondary">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
        </div>

        <div th:if="${session.currentUser != null and session.currentUser.role.name() == 'ADMIN' and event.status != 'FINISHED'}" 
             style="margin-top: 30px; padding: 20px; border: 2px solid #ff5722; border-radius: 8px;">
            
            <h4 style="color: #ff5722;">üëë –ê–¥–º–∏–Ω-–∑–æ–Ω–∞: –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</h4>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ, –∫–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–±–µ–¥–∏–ª. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!</p>

            <form method="post" th:action="@{/events/{id}/finish(id=${event.id})}">
                <label>–ü–æ–±–µ–¥–∏–≤—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç:
                    <select name="winningOptionId" required>
                        <option value="" disabled selected>-- –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ö–æ–¥ --</option>
                        <option th:each="opt : ${event.optionsWithStats}" 
                                th:value="${opt.optionId}" 
                                th:text="${opt.text}"></option>
                    </select>
                </label>
                <button type="submit" style="background-color: #ff5722; border-color: #ff5722;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
            </form>
        </div>
        
        <div th:if="${event.status == 'FINISHED'}" style="margin-top: 20px; padding: 15px; background-color: #e8f5e9; border: 1px solid #4caf50; border-radius: 4px;">
            <h3>üèÅ –°–æ–±—ã—Ç–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</h3>
    
        </div>
    </article>
</main>
<footer th:replace="~{fragments/footer :: footer}"></footer>
</body>
</html>