<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head}"></head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>
<main class="container">
    <article>
        <h1 th:text="${event.title}"></h1>
        <p th:text="${event.description}"></p>
        <p><strong>Статус:</strong> <span th:text="${event.status}"></span></p>

        <div th:if="${successMessage}" style="background-color: #d4edda; color: #155724; padding: 10px; margin-bottom: 10px; border-radius: 4px;">
            <span th:text="${successMessage}"></span>
        </div>
        <div th:if="${errorMessage}" style="background-color: #f8d7da; color: #721c24; padding: 10px; margin-bottom: 10px; border-radius: 4px;">
            <span th:text="${errorMessage}"></span>
        </div>

        <div th:if="${!hasVoted}">
        <form method="post" th:action="@{/predictions/make}">
            
            <input type="hidden" name="eventId" th:value="${event.id}">
            
            <h3>Сделайте ваш выбор:</h3>

            <div th:each="opt : ${event.optionsWithStats}" style="margin-bottom: 5px;">
                <label>
                    <input type="radio" name="chosenOptionId" th:value="${opt.optionId}" required>
                    <span th:text="${opt.text}">Текст варианта</span>
                </label>
            </div>
            <button type="submit" style="margin-top: 15px;">Подтвердить выбор</button>
        </form>
        </div>
        <hr>
        <div th:if="${hasVoted}" style="padding: 20px; background-color: #f0f0f0; border-radius: 8px; text-align: center;">
            <h3>✅ Вы уже сделали ставку в этом событии</h3>
            <p>Дождитесь окончания события, чтобы узнать результат.</p>
        </div>
        <!-- Блок для администратора: кнопки управления событием -->
        <div th:if="${currentUser != null and currentUser.role.name() == 'ADMIN'}"
             style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px;">
            
            <h4>Панель управления событием</h4>
            
            <div style="margin-bottom: 10px;">
                <form th:action="@{/events/delete/{id} (id=${event.id})}" th:method="GET"
                      onsubmit="return confirm('Вы уверены, что хотите удалить это событие?')">
                    <button type="submit" class="secondary outline">Удалить событие</button>
                </form>
            </div>
            
            <div th:if="${event.status != 'FINISHED'}">
                <h5>Завершить событие</h5>
                <p>Выберите, какой вариант победил. Это действие необратимо!</p>

                <form method="post" th:action="@{/events/{id}/finish(id=${event.id})}">
                    <label>Победивший вариант:
                        <select name="winningOptionId" required>
                            <option value="" disabled selected> Выберите исход </option>
                            <option th:each="opt : ${event.optionsWithStats}"
                                    th:value="${opt.optionId}"
                                    th:text="${opt.text}"></option>
                        </select>
                    </label>
                    <button type="submit" class="secondary">Подтвердить результат</button>
                </form>
            </div>
        </div>
    
        <div style="margin-top: 10px;">
            <a href="/events/all" role="button" class="secondary">Назад к списку</a>
        </div>
        
        <div th:if="${event.status == 'FINISHED'}" style="margin-top: 20px; padding: 15px; background-color: #e8f5e9; border: 1px solid #4caf50; border-radius: 4px;">
            <h3> Событие завершено</h3>
    
        </div>
    </article>
</main>
<footer th:replace="~{fragments/footer :: footer}"></footer>
</body>
</html>